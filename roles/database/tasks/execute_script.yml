
- name: 'Discovery DB'
  when: db_unique_name is not defined
  include_tasks: 'db_discovery.yml'  

- name: 'Discover DB Home for Database {{ workload_tag }}{{ db_name }}'
  when: oracle_home is not defined
  include_role:
    name: 'database_home'
    tasks_from: 'db_home_discovery.yml'

- name: 'Assert that oracle_unique_name and oracle_home are defined'
  assert: { that: db_unique_name is defined and oracle_home is defined }

- name: 'Copy Script to Host'
  copy:
    src: 'sample_script'
    dest: '/home/oracle/'
  register: 'copy_script_result'
- debug:
    msg: '{{ copy_script_result }}'

- name: Change file ownership, group and permissions
  ansible.builtin.file:
    path: /home/oracle/sample_script
    mode: '0770'

- name: 'Execute Script'
  shell: |
    ./sample_script
  args:
    chdir: /home/oracle/
  register: script_execution_result
- debug:
    msg: "{{ script_execution_result }}"


# - name: 'Execute SQL Script'
#   shell: echo exit |
#     $ORACLE_HOME/bin/sqlplus -s / as sysdba @/home/oracle/sample_script.sql
#   environment:
#     ORACLE_HOME: '{{ oracle_home }}'
#     ORACLE_SID: '{{ oracle_sid }}'
#     ORACLE_UNIQUE_NAME: '{{ oracle_unique_name }}'
#   register: result
# - debug:
#     msg: "{{ result }}"